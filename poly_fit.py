#!/usr/bin/env python3

import numpy as np
import matplotlib.pyplot as plt
wl = [429.3, 432.9, 436.5, 440.1, 443.7, 447.3, 450.9, 454.5, 458.1, 461.7, 465.3, 468.9, 472.5, 476.1, 479.7, 483.3, 486.9, 490.5, 494.1, 497.7, 501.3, 504.9, 508.5, 512.1, 515.7, 519.3, 522.9, 526.5, 530.1, 533.7, 537.3, 540.9, 544.5, 548.1, 551.7, 555.3, 558.9, 562.5, 566.1, 569.7, 573.3, 576.9, 580.5, 584.1, 587.7, 591.3, 594.9, 598.5, 602.1, 605.7, 609.3, 612.9, 616.5, 620.1, 623.7, 627.3, 630.9, 634.5, 638.1, 641.7, 645.3, 648.9, 652.5, 656.1, 659.7, 663.3, 666.9, 670.5, 674.1, 677.7, 681.3, 684.9, 688.5, 692.1, 695.7, 699.3, 702.9, 706.5, 710.1, 713.7, 717.3, 720.9, 724.5, 728.1, 731.7, 735.3, 738.9, 742.5, 746.1, 749.7, 753.3, 756.9, 760.5, 764.1, 767.7, 771.3, 774.9, 778.5, 782.1, 785.7, 789.3, 792.9, 796.5, 800.1, 803.7, 807.3, 810.9, 814.5, 818.1, 821.7, 825.3, 828.9, 832.5, 836.1, 839.7, 843.3, 846.9, 850.5, 854.1, 857.7, 861.3, 864.9, 868.5, 872.1, 875.7, 879.3, 882.9, 886.5, 890.1, 893.7, 897.3]
wl = np.array(wl)
wavelength = wl
rad = [3.2303505,3.5319998,3.5533652,3.736868,3.8811393,4.056,4.131844,3.9652004,3.963242,3.9085865,3.7178843,3.8381338,4.0079174,3.9825284,3.9542725,3.6183953,3.6366405,3.762492,3.824532,3.5287867,3.5445454,3.6565657,3.5814536,3.4856205,3.1078777,3.4324296,3.3840208,3.3563042,3.4425929,3.4075792,3.3029938,3.1864672,3.212044,3.145562,3.0782983,3.024282,2.91648,2.867491,2.7557666,2.7174847,2.7352402,2.7354903,2.6803277,2.5715292,2.3826983,2.510704,2.5279408,2.4504673,2.504886,2.4932334,2.4031143,2.4244587,2.4948184,2.3756268,2.368659,2.3874428,2.4992428,2.4670475,2.5206738,2.5824788,2.4850013,2.635194,2.4756284,2.536131,2.646721,2.5313554,2.6038237,2.583673,2.4856472,2.5182173,2.460165,2.080367,2.1746736,2.352987,2.4972348,2.5269501,2.7564323,2.7792895,2.9536536,2.6303058,2.2936463,2.6889071,2.5998075,2.8784986,3.2396328,3.4092302,3.5925694,3.8103676,4.083464,4.266593,4.4360437,3.1072383,1.977026,3.4620552,4.660692,4.880843,5.0230303,5.4866624,5.3181334,5.4163795,5.272587,5.7499022,5.9548182,5.999603,6.1486716,6.3258405,5.6437073,5.1437736,5.398481,5.545127,6.0457478,5.803678,6.318781,6.349358,6.6883583,6.5971355,6.666449,6.4283123,6.153194,6.8006186,6.4890127,6.270568,6.6957774,6.9180827,6.8687367,6.7712584,6.8648224,6.960615,6.845924,6.716521,5.900702]
rad = np.array(rad)

poly_cof5 = np.polyfit(wl, rad, 5)

def get_poly(r):
  polycof = np.polyfit(wavelength, r, 6)
  return polycof

def normalize(r):
  polycof = get_poly(r)
  polyval = np.polyval(polycof, wavelength)
  r = np.copy(r)
  r -= np.min(polyval)
  r /= np.max(polyval) - np.min(polyval)
  return r

def rmse(poly_cof, r):
  return np.sqrt(np.mean((r - np.polyval(poly_cof, wl))**2))


rad2 = [4.722399,5.127258,5.2527323,5.894094,5.8901176,6.2998586,6.193356,6.1898556,6.0319037,6.229834,5.875023,6.0854506,6.244723,6.165354,5.8591514,5.4408417,5.4430585,5.719123,5.7104187,5.3994317,5.296494,5.3735037,5.318377,5.1357713,4.920239,4.999165,4.9708066,5.182128,5.0456214,4.8843,4.7665315,4.721005,4.649809,4.742734,4.6381035,4.383131,4.2093005,4.205796,4.0086575,4.074287,4.016699,3.9942944,4.014978,3.837703,3.673531,3.7192845,3.7519972,3.835875,3.7549329,3.7086282,3.7229128,3.560789,3.611259,3.5470202,3.4981701,3.6343408,3.5656312,3.7532468,3.7055469,3.7700567,3.678754,3.72553,3.608904,3.8178787,3.8759596,3.8216734,3.815137,3.7406588,3.688376,3.5828397,3.3213456,2.7121491,3.0135574,2.9462066,3.1597536,3.13184,3.4015677,3.3562994,3.3916721,3.0401752,2.581806,3.0225482,2.9073727,3.0789838,3.744136,3.779285,4.0671463,4.216798,4.558743,4.663322,4.7835937,2.9015486,2.2175612,3.9977846,5.0777,5.2857914,5.562853,5.871749,5.84314,5.617089,5.770231,6.117182,6.334673,6.7682323,6.854251,6.8614345,6.4205,5.9547677,6.1793675,6.3067207,6.57071,6.698284,7.205124,7.6061234,7.9953103,8.025011,7.5878143,7.612391,7.5490355,7.773492,7.7319627,7.57705,7.861475,8.482078,7.925091,8.835178,8.639538,8.70136,9.027049,8.515841,7.876538]
rad2 = np.array(rad2)
rad3 = [4.8606906,5.472711,5.393578,5.7750835,6.1816945,6.5273213,6.3961616,6.2135477,6.3187847,6.2595744,6.106161,6.053791,6.12167,6.1724944,6.055579,5.5402713,5.836399,5.7332067,5.7793484,5.690201,5.3520226,5.744721,5.6400313,5.0357447,4.9940605,5.2898035,5.1404586,5.181429,5.205572,5.1511226,4.849787,4.798948,4.8702183,4.7753863,4.782949,4.564185,4.4981284,4.482778,4.3087115,4.1861973,4.1940885,4.2524176,4.3369765,4.0914392,3.8293355,3.9841628,3.9815066,3.9994311,3.8213382,3.9195797,3.8772805,3.8842638,3.8695168,3.9311426,3.7712939,3.688932,3.8863342,3.9602504,4.023965,3.9967177,3.828607,3.8996422,3.824402,3.9582217,4.239914,4.07658,4.123156,3.8946488,4.0176816,3.8300955,3.4864442,3.095617,3.2914534,3.3234234,3.5554583,3.3936636,3.5301368,3.6113837,3.643724,3.1782808,2.8815966,3.1195166,3.1929302,3.3028061,3.9299116,4.0750375,4.278357,4.6605654,4.815703,4.933467,5.1023493,3.1622012,2.29595,4.28445,5.550628,5.7203836,5.9610357,6.1398954,6.367277,5.9355655,6.030676,6.4945207,6.8310823,7.041998,7.213241,7.0948534,6.572374,6.1584144,6.5327706,6.5485654,7.2031207,7.2291675,7.3896103,7.825403,8.20651,7.937783,8.221754,7.866135,7.9474206,7.7002354,7.6554418,7.887101,8.506263,8.739546,8.251116,8.956373,8.727139,9.131234,8.635571,8.801223,8.184329,]
rad3 = np.array(rad3)
rad_bwb = [4.527344,5.252125,5.3778377,5.9804306,6.349075,6.5237617,6.493655,6.622856,6.633884,6.658289,6.516067,6.622327,6.9550266,6.955283,6.890365,6.4187956,6.5549264,6.6798797,6.6338315,6.331189,6.350665,6.6120787,6.727092,6.255029,5.6674013,6.119027,6.2407427,6.1371613,6.3960185,6.1844935,5.941276,5.870341,5.8764687,5.939636,5.998454,5.6264343,5.4507384,5.4336395,5.252253,5.238077,5.0112786,5.194892,5.1349635,5.08387,4.752256,4.770167,4.792956,4.7782135,4.851393,4.656755,4.708353,4.538606,4.5649505,4.5110803,4.3434043,4.465433,4.505382,4.472415,4.53902,4.591683,4.4071097,4.523754,4.2571054,4.433339,4.540935,4.495358,4.5326247,4.537136,4.3826747,4.212312,4.195755,3.6272964,3.7235994,3.7553627,3.9512463,3.7418132,3.9829862,4.112904,3.9837275,3.6942556,3.1319296,3.325959,3.2729638,3.3187068,3.7354822,3.9045825,4.0705986,4.136295,4.1680813,4.3026624,4.237149,3.0414393,1.7255569,2.9642446,3.8383546,4.0508356,4.096726,4.092677,4.046276,3.9900296,4.056436,3.8894532,4.421226,4.3706813,4.593836,4.498166,4.5470653,3.9752665,4.1250486,4.524456,4.737615,4.732082,5.0971036,5.2835984,5.2904787,5.460672,5.069269,5.3741145,5.092529,5.1384735,4.92459,5.660173,5.594578,6.0193453,5.977462,5.8779716,6.0700297,6.6303496,6.783516,7.2243586,6.8867736]
rad_water = [0.909893,0.965766,1.0280218,1.1072217,1.2150258,1.2334235,1.136007,1.2570127,1.2155769,1.1391814,1.1474242,1.2046738,1.2390089,1.2295208,1.1762378,1.1738347,1.1712582,1.2404064,1.2136453,1.1345203,1.1783288,1.1668802,1.2184684,1.2062867,1.267063,1.2109028,1.2382886,1.3568885,1.4037238,1.3597039,1.3047544,1.3580818,1.4100541,1.4370544,1.4231333,1.3319952,1.3587722,1.3338157,1.3640511,1.3400156,1.2870381,1.333808,1.3694636,1.2196674,1.2070681,1.2297087,1.2699151,1.2672062,1.2261567,1.2476279,1.1906103,1.2103285,1.1879172,1.1607178,1.1102419,1.1324916,1.1556679,1.1419158,1.1077133,1.021697,1.0003564,1.0663823,0.9103883,0.9959206,0.9404811,0.89566624,0.8737002,0.93906885,0.9071814,0.8320701,0.83028185,0.7922398,0.9809639,1.0562577,1.3024056,1.3413968,1.4087076,1.5005692,1.4058343,1.075829,1.0155995,1.0223328,0.96580154,0.99996585,1.124104,1.1670592,1.1438974,1.2487258,1.2808148,1.2943811,1.2159154,0.5025605,0.52285486,1.0295186,1.3641218,1.3919677,1.4099151,1.3862596,1.3642677,1.2871851,1.2429463,1.2728144,1.5129333,1.4390024,1.5597075,1.4263563,1.2146719,1.1289233,1.1703515,1.1287047,1.2150189,1.2382393,1.3622398,1.2202216,1.3771363,1.3732527,1.4820049,1.3975974,1.4127012,1.1977854,1.3429556,1.2636728,1.4799602,1.456015,1.4386585,1.439613,1.585941,1.4604187,1.4263988,1.3281827,1.2578588]
# plt.plot(wl, rad, 'r--')
plt.plot(wl, normalize(rad), 'r:')
# plt.plot(wl, rad2, 'b--')
# plt.plot(wl, normalize(rad2), 'b-')
# plt.plot(wl, rad3, 'g--')
plt.plot(wl, normalize(rad3), 'g-')
# plt.plot(wl, rad_water, 'k--')
# plt.plot(wl, normalize(rad_water), 'k-')
# plt.plot(wavelength, [np.polyval(poly_cof5, i) for i in wavelength], 'r')
# plt.ylim([-0.5,1.5])
poly_cof_nor = get_poly(normalize(rad3))
plt.plot(wavelength, [np.polyval(poly_cof_nor, i) for i in wavelength], 'r')
print('rad3')
print('rad1', rmse(poly_cof_nor, normalize(rad)))
print('rad2', rmse(poly_cof_nor, normalize(rad2)))
print('rad3', rmse(poly_cof_nor, normalize(rad3)))
print('radwater', rmse(poly_cof_nor, normalize(rad_water)))
print('radbwb', rmse(poly_cof_nor, normalize(rad_bwb)))
plt.plot(wl, normalize(rad_water), 'k:')
plt.plot(wl, normalize(rad_bwb), 'y:')
plt.show()
